# â¬†ï¸ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø±ØªÙ‚Ø§ Ø®ÙˆØ¯Ú©Ø§Ø± Ù†Ù‚Ø´ (Role Upgrade)

Ø§ÛŒÙ† Ù…Ø³ØªÙ†Ø¯ Ù†Ø­ÙˆÙ‡ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø³ÛŒØ³ØªÙ… Ø§Ø±ØªÙ‚Ø§ Ø®ÙˆØ¯Ú©Ø§Ø± Ù†Ù‚Ø´ Ø±Ø§ ØªÙˆØ¶ÛŒØ­ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.

---

## ğŸ¯ Ù‡Ø¯Ù

Ú©Ø§Ø±Ø¨Ø±Ø§Ù†ÛŒ Ú©Ù‡ Ø§Ø¨ØªØ¯Ø§ Ø¨Ø§ Ù†Ù‚Ø´ `user` Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø¨Ø¹Ø¯Ø§Ù‹ Ø¨Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù‚Ø´ `event_owner` Ù‡Ù†Ú¯Ø§Ù… ÙˆØ±ÙˆØ¯ØŒ Ø¨Ù‡ Ø§ÛŒÙ† Ù†Ù‚Ø´ Ø§Ø±ØªÙ‚Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†Ù†Ø¯.

---

## ğŸ“‹ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù

### Ø³Ù†Ø§Ø±ÛŒÙˆ 1: Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§ User

```
Ø±ÙˆØ² Ø§ÙˆÙ„:
  Ú©Ø§Ø±Ø¨Ø±: Ø¹Ù„ÛŒ
  Ø´Ù…Ø§Ø±Ù‡: 09121111111
  Ø§Ù†ØªØ®Ø§Ø¨: ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ

  Ù†ØªÛŒØ¬Ù‡:
  âœ… roles: ["user"]
```

### Ø³Ù†Ø§Ø±ÛŒÙˆ 2: Ø§Ø±ØªÙ‚Ø§ Ø¨Ù‡ Event Owner

```
Ø±ÙˆØ² Ø¯ÙˆÙ… (Ù‡Ù…Ø§Ù† Ú©Ø§Ø±Ø¨Ø±):
  Ú©Ø§Ø±Ø¨Ø±: Ø¹Ù„ÛŒ
  Ø´Ù…Ø§Ø±Ù‡: 09121111111 (Ù‡Ù…ÙˆÙ† Ø´Ù…Ø§Ø±Ù‡)
  Ø§Ù†ØªØ®Ø§Ø¨: â­ Ù…Ø§Ù„Ú© / Ù…Ø¯ÛŒØ± Ø±ÙˆÛŒØ¯Ø§Ø¯

  Ù†ØªÛŒØ¬Ù‡:
  âœ… roles: ["user", "event_owner"]  ğŸ‘ˆ Ø§Ø±ØªÙ‚Ø§ Ø®ÙˆØ¯Ú©Ø§Ø±!
```

### Ø³Ù†Ø§Ø±ÛŒÙˆ 3: ÙˆØ±ÙˆØ¯ Ù…Ø¬Ø¯Ø¯ (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)

```
Ø±ÙˆØ² Ø³ÙˆÙ…:
  Ú©Ø§Ø±Ø¨Ø±: Ø¹Ù„ÛŒ
  Ø´Ù…Ø§Ø±Ù‡: 09121111111
  Ø§Ù†ØªØ®Ø§Ø¨: ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ (Ø¯ÙˆØ¨Ø§Ø±Ù‡ user Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯)

  Ù†ØªÛŒØ¬Ù‡:
  âœ… roles: ["user", "event_owner"]  ğŸ‘ˆ Ù†Ù‚Ø´ Ø­Ø°Ù Ù†Ù…ÛŒØ´Ù‡!
```

---

## ğŸ’» Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ

### Backend Logic

```javascript
// Ø¯Ø± verify-otp API route

if (!user) {
  // Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯
  let userRoles = ["user"];
  if (role === "event_owner") {
    userRoles.push("event_owner");
  }
  user = new User({ roles: userRoles, ... });
} else {
  // Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¯ÛŒÙ…ÛŒ

  // âœ¨ Ø§Ø±ØªÙ‚Ø§ Ø®ÙˆØ¯Ú©Ø§Ø±
  if (role === "event_owner" && !user.roles.includes("event_owner")) {
    console.log("â¬†ï¸ Upgrading user role to event_owner");
    user.roles.push("event_owner");

    // Ø«Ø¨Øª Ù„Ø§Ú¯
    await logActivity(phoneNumber, "role_upgrade", {
      metadata: {
        newRole: "event_owner",
        allRoles: user.roles,
      },
    });
  }

  user.lastLoginAt = new Date();
  await user.save();
}
```

---

## ğŸ§ª ØªØ³Øª Ú©Ø§Ù…Ù„

### Ù…Ø±Ø­Ù„Ù‡ 1: Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¨Ø§ User

```bash
1. Ø±ÙØªÙ† Ø¨Ù‡ http://localhost:3000/login
2. Ø´Ù…Ø§Ø±Ù‡: 09123456789
3. Ø§Ù†ØªØ®Ø§Ø¨: ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ
4. Ø¯Ø±ÛŒØ§ÙØª Ùˆ ØªØ§ÛŒÛŒØ¯ OTP
```

**Ú†Ú© Ú©Ø±Ø¯Ù†:**

```bash
npm run check-user 09123456789
```

**Ø®Ø±ÙˆØ¬ÛŒ:**

```
Ù†Ù‚Ø´â€ŒÙ‡Ø§: [user]
ØªØ¹Ø¯Ø§Ø¯ Ù†Ù‚Ø´â€ŒÙ‡Ø§: 1
```

---

### Ù…Ø±Ø­Ù„Ù‡ 2: Ø§Ø±ØªÙ‚Ø§ Ø¨Ù‡ Event Owner

```bash
1. Ø±ÙØªÙ† Ø¨Ù‡ http://localhost:3000/login
2. Ù‡Ù…Ø§Ù† Ø´Ù…Ø§Ø±Ù‡: 09123456789
3. Ø§Ù†ØªØ®Ø§Ø¨: â­ Ù…Ø§Ù„Ú© / Ù…Ø¯ÛŒØ± Ø±ÙˆÛŒØ¯Ø§Ø¯
4. Ø¯Ø±ÛŒØ§ÙØª Ùˆ ØªØ§ÛŒÛŒØ¯ OTP
```

**Ø¯Ø± Terminal Ø¨Ø§ÛŒØ¯ Ø¨Ø¨ÛŒÙ†ÛŒØ¯:**

```
â¬†ï¸ Upgrading user role to event_owner
âœ… User role upgraded: [ 'user', 'event_owner' ]
```

**Ú†Ú© Ú©Ø±Ø¯Ù†:**

```bash
npm run check-user 09123456789
```

**Ø®Ø±ÙˆØ¬ÛŒ:**

```
Ù†Ù‚Ø´â€ŒÙ‡Ø§: [user, event_owner]  ğŸ‘ˆ Ù‡Ø± Ø¯Ùˆ Ù†Ù‚Ø´!
ØªØ¹Ø¯Ø§Ø¯ Ù†Ù‚Ø´â€ŒÙ‡Ø§: 2

ğŸ­ ØªØ­Ù„ÛŒÙ„ Ù†Ù‚Ø´â€ŒÙ‡Ø§:
   âœ“ User (Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ): âœ… Ø¯Ø§Ø±Ø¯
   âœ“ Event Owner (Ù…Ø§Ù„Ú© Ø±ÙˆÛŒØ¯Ø§Ø¯): âœ… Ø¯Ø§Ø±Ø¯
```

---

### Ù…Ø±Ø­Ù„Ù‡ 3: ÙˆØ±ÙˆØ¯ Ù…Ø¬Ø¯Ø¯ (ØªØ³Øª Ø¹Ø¯Ù… Downgrade)

```bash
1. Ø±ÙØªÙ† Ø¨Ù‡ http://localhost:3000/login
2. Ù‡Ù…Ø§Ù† Ø´Ù…Ø§Ø±Ù‡: 09123456789
3. Ø§Ù†ØªØ®Ø§Ø¨: ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø± Ø¹Ø§Ø¯ÛŒ (Ø¹Ù…Ø¯Ø§Ù‹ user Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…)
4. Ø¯Ø±ÛŒØ§ÙØª Ùˆ ØªØ§ÛŒÛŒØ¯ OTP
```

**Ú†Ú© Ú©Ø±Ø¯Ù†:**

```bash
npm run check-user 09123456789
```

**Ø®Ø±ÙˆØ¬ÛŒ:**

```
Ù†Ù‚Ø´â€ŒÙ‡Ø§: [user, event_owner]  ğŸ‘ˆ Ù‡Ù†ÙˆØ² Ù‡Ø± Ø¯Ùˆ Ù†Ù‚Ø´ Ø¯Ø§Ø±Ø¯!
ØªØ¹Ø¯Ø§Ø¯ Ù†Ù‚Ø´â€ŒÙ‡Ø§: 2
```

âœ… **Ù†Ù‚Ø´ event_owner Ø­Ø°Ù Ù†Ø´Ø¯!** (Ø§Ù…Ù†ÛŒØªÛŒ)

---

## ğŸ”’ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø§Ù…Ù†ÛŒØªÛŒ

### âœ… Ù…Ø¬Ø§Ø²:

1. **User â†’ User + Event Owner**

   ```
   ["user"] â†’ ["user", "event_owner"]
   ```

2. **User + Event Owner â†’ User + Event Owner**
   ```
   ["user", "event_owner"] â†’ ["user", "event_owner"]
   (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)
   ```

### âŒ ØºÛŒØ±Ù…Ø¬Ø§Ø² (Ø®ÙˆØ¯Ú©Ø§Ø± Ù†ÛŒØ³Øª):

1. **User + Event Owner â†’ User**

   ```
   ["user", "event_owner"] âŒâ†’ ["user"]
   (Ù†Ù‚Ø´ Ø­Ø°Ù Ù†Ù…ÛŒØ´Ù‡)
   ```

2. **User â†’ User + Moderator**

   ```
   ["user"] âŒâ†’ ["user", "moderator"]
   (ÙÙ‚Ø· Admin Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Moderator Ø¨Ø¯Ù‡)
   ```

3. **User â†’ User + Admin**
   ```
   ["user"] âŒâ†’ ["user", "admin"]
   (ÙÙ‚Ø· Ø§Ø² Ø·Ø±ÛŒÙ‚ Script)
   ```

---

## ğŸ“Š Ø¨Ø±Ø±Ø³ÛŒ Activity Logs

ØªÙ…Ø§Ù… ØªØºÛŒÛŒØ±Ø§Øª Ù†Ù‚Ø´ Ø¯Ø± ActivityLog Ø«Ø¨Øª Ù…ÛŒâ€ŒØ´ÙˆØ¯:

### MongoDB Query:

```javascript
db.activitylogs
  .find({
    action: "role_upgrade",
    userId: "09123456789",
  })
  .sort({ timestamp: -1 });
```

### Ù†ØªÛŒØ¬Ù‡:

```json
{
  "userId": "09123456789",
  "action": "role_upgrade",
  "targetType": "User",
  "metadata": {
    "newRole": "event_owner",
    "allRoles": ["user", "event_owner"]
  },
  "timestamp": "2025-01-27T10:30:00.000Z"
}
```

---

## ğŸ® Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Frontend

### Ú†Ú© Ú©Ø±Ø¯Ù† Ø§Ø±ØªÙ‚Ø§

```javascript
import { useAuth } from "@/contexts/AuthContext";

function UserProfile() {
  const { user } = useAuth();

  const isUpgraded =
    user.roles.includes("user") && user.roles.includes("event_owner");

  return (
    <div>
      {isUpgraded && (
        <div className="upgrade-badge">
          ğŸ‰ Ø´Ù…Ø§ Ø¨Ù‡ Event Owner Ø§Ø±ØªÙ‚Ø§ ÛŒØ§ÙØªÙ‡â€ŒØ§ÛŒØ¯!
        </div>
      )}
    </div>
  );
}
```

### Ù†Ù…Ø§ÛŒØ´ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø¬Ø¯ÛŒØ¯

```javascript
function Dashboard() {
  const { user } = useAuth();

  return (
    <div>
      {/* Ù‡Ù…Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† */}
      <button>Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§</button>

      {/* ÙÙ‚Ø· Event Owner */}
      {user.roles.includes("event_owner") && (
        <>
          <button>Ø§ÛŒØ¬Ø§Ø¯ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¬Ø¯ÛŒØ¯</button>
          <button>Ù…Ø¯ÛŒØ±ÛŒØª Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù…Ù†</button>
        </>
      )}
    </div>
  );
}
```

---

## âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ùˆ Ø³ÙØ§Ø±Ø´ÛŒâ€ŒØ³Ø§Ø²ÛŒ

### ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø§Ø±ØªÙ‚Ø§ Ø®ÙˆØ¯Ú©Ø§Ø±

Ø§Ú¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ø±ØªÙ‚Ø§ Ø®ÙˆØ¯Ú©Ø§Ø± ØºÛŒØ±ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯ØŒ Ú©Ø¯ Ø²ÛŒØ± Ø±Ø§ Ú©Ø§Ù…Ù†Øª Ú©Ù†ÛŒØ¯:

```javascript
// Ø¯Ø± verify-otp route

// âœ¨ Ø§Ø±ØªÙ‚Ø§ Ù†Ù‚Ø´: Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± event_owner Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯Ù‡ Ùˆ Ù‚Ø¨Ù„Ø§Ù‹ Ù†Ø¯Ø§Ø±Ù‡ØŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
/*
let roleUpdated = false;
if (role === "event_owner" && !user.roles.includes("event_owner")) {
  console.log("â¬†ï¸ Upgrading user role to event_owner");
  user.roles.push("event_owner");
  roleUpdated = true;
}
*/
```

### Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø´Ø±Ø§ÛŒØ· Ø¯ÛŒÚ¯Ø±

```javascript
// ÙÙ‚Ø· Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Verified Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø§Ø±ØªÙ‚Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†Ù†Ø¯
if (
  role === "event_owner" &&
  !user.roles.includes("event_owner") &&
  user.state === "verified" // ğŸ‘ˆ Ø´Ø±Ø· Ø§Ø¶Ø§ÙÙ‡
) {
  user.roles.push("event_owner");
  roleUpdated = true;
}
```

---

## ğŸ” Ø¯ÛŒØ¨Ø§Ú¯ Ùˆ Ø±ÙØ¹ Ù…Ø´Ú©Ù„

### Ù…Ø´Ú©Ù„: Ø§Ø±ØªÙ‚Ø§ Ø§ØªÙØ§Ù‚ Ù†Ù…ÛŒâ€ŒØ§ÙØªØ¯

**Ú†Ú© Ú©Ø±Ø¯Ù†:**

1. **Backend Logs:**

   ```
   â¬†ï¸ Upgrading user role to event_owner  ğŸ‘ˆ Ø¨Ø§ÛŒØ¯ Ø¨Ø¨ÛŒÙ†ÛŒØ¯
   ```

2. **Browser Console:**

   ```javascript
   console.log(user.roles);
   // Ø¨Ø§ÛŒØ¯ ["user", "event_owner"] Ø¨Ø§Ø´Ø¯
   ```

3. **Database:**
   ```bash
   npm run check-user 09123456789
   ```

**Ø¹Ù„Ù„ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ:**

1. Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¨Ù„Ø§Ù‹ event_owner Ø¯Ø§Ø´ØªÙ‡
2. `role` Ø¯Ø± request Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡
3. Ú©Ø§Ø±Ø¨Ø± Admin Ø§Ø³Øª (Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ Ø§Ø±ØªÙ‚Ø§ Ù†Ø¯Ø§Ø±Ø¯)

---

## ğŸ“ˆ Ø¢Ù…Ø§Ø± Ø§Ø±ØªÙ‚Ø§

### Query ØªØ¹Ø¯Ø§Ø¯ Ø§Ø±ØªÙ‚Ø§Ù‡Ø§:

```javascript
db.activitylogs.countDocuments({
  action: "role_upgrade",
});
```

### Query Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø§ event_owner:

```javascript
db.users.countDocuments({
  roles: "event_owner",
});
```

---

## ğŸ’¡ Ù†Ú©Ø§Øª Ù…Ù‡Ù…

1. âœ… Ø§Ø±ØªÙ‚Ø§ Ø®ÙˆØ¯Ú©Ø§Ø± ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ `event_owner` ÙØ¹Ø§Ù„ Ø§Ø³Øª
2. âœ… Ù†Ù‚Ø´â€ŒÙ‡Ø§ Ù‡Ø±Ú¯Ø² Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø­Ø°Ù Ù†Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
3. âœ… ØªÙ…Ø§Ù… Ø§Ø±ØªÙ‚Ø§Ù‡Ø§ Ø¯Ø± ActivityLog Ø«Ø¨Øª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
4. âœ… Admin Panel Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù‡Ø± Ù†Ù‚Ø´ÛŒ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡/Ø­Ø°Ù Ú©Ù†Ø¯
5. âš ï¸ Moderator ÙÙ‚Ø· Ø§Ø² Ø·Ø±ÛŒÙ‚ Admin Ù‚Ø§Ø¨Ù„ ØªØ®ØµÛŒØµ Ø§Ø³Øª

---

## ğŸ”— Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù…Ø±ØªØ¨Ø·

- [Testing Roles](./TESTING_ROLES.md)
- [Role Selection](./ROLE_SELECTION.md)
- [User System](./USER_SYSTEM.md)
- [RBAC Guide](./RBAC_GUIDE.md)

---

**Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ:** 2025-01-27



