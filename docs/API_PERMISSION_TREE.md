# ุฑุงูููุง API Permission Tree

## ๐ฏ ูุฏู

ฺฉุงููพูููุช `ApiPermissionTree` ฺฉ ููุง ุฏุฑุฎุช ุจุฑุง ูุฏุฑุช ุฏุณุชุฑุณโูุง API ุฏุฑ ุณุณุชู RBAC ุงุฑุงุฆู ูโุฏูุฏ. ุงู ฺฉุงููพูููุช ุฌุงฺฏุฒู `ApiPermissionGrid` ุดุฏู ู UX ุจูุชุฑ ุจุฑุง ูุฏุฑุช endpoint ูุง ูุชุนุฏุฏ ูุฑุงูู ูโฺฉูุฏ.

---

## ๐ณ ุณุงุฎุชุงุฑ ุฏุฑุฎุช

### ูุจู (ApiPermissionGrid):

```
๐ Module: admin
  โโ /api/admin/users (GET, POST)
  โโ /api/admin/users/:id (GET, PUT, DELETE)
  โโ /api/admin/users/:id/roles (PUT)
  โโ /api/admin/rbac/roles (GET, POST)
  โโ /api/admin/rbac/roles/:id (GET, PUT, DELETE)
  โโ ...

โ ูุดฺฉูุงุช:
- ุดููุบ ู ุฎูุงูุง ูพุงู
- ุงุฑุชุจุงุท endpoint ูุง ูุงุถุญ ูุณุช
- ูพูุงุด ุณุฎุช ุฏุฑ endpoint ูุง ุฒุงุฏ
```

### ุจุนุฏ (ApiPermissionTree):

```
๐ api
  ๐ auth
    ๐ /api/auth/login (POST)
    ๐ /api/auth/send-otp (POST)
    ๐ /api/auth/verify-otp (POST)
  ๐ admin
    ๐ users
      ๐ /api/admin/users (GET, POST)
      ๐ /api/admin/users/:id (GET, PUT, DELETE)
      ๐ /api/admin/users/:id/roles (PUT)
    ๐ rbac
      ๐ roles
        ๐ /api/admin/rbac/roles (GET, POST)
        ๐ /api/admin/rbac/roles/:id (GET, PUT, DELETE)
      ๐ /api/admin/rbac/menus (GET, POST)
      ๐ /api/admin/rbac/apis (GET, POST)
  ๐ user
    ๐ /api/user/profile (GET, PUT)

โ ูุฒุงุง:
- ุณุงุฒูุงูโุงูุชู ู ุฎูุงูุง
- ุงุฑุชุจุงุท endpoint ูุง ูุงุถุญ
- ุจุงุฒ/ุจุณุช ฺฉุฑุฏู ุจุฎุดโูุง ูุฎุชูู
- ูพุฏุง ฺฉุฑุฏู ุณุฑุน endpoint ูุง
```

---

## ๐จ ูฺฺฏโูุง

### 1๏ธโฃ ุณุงุฎุชุงุฑ ุณูุณูู ูุฑุงุชุจ

- **ูพูุดูโูุง** (Folders): ุจุฎุดโูุง ูุฎุชูู API (ูุซูุงู `auth`, `admin`, `users`)
- **ูุงูโูุง** (Files): endpoint ูุง ูุงูุน ฺฉู ูุชุฏูุง ุฑู ุงูุชุฎุงุจ ูโฺฉู

### 2๏ธโฃ ุขฺฉููโูุง ุจุตุฑ

- `๐` ูููุฏุฑ ุจุณุชู
- `๐` ูููุฏุฑ ุจุงุฒ
- `๐` endpoint (ูุงู)

### 3๏ธโฃ ฺฉูุชุฑูโูุง expansion

- ฺฉูฺฉ ุฑู ูพูุดู โ ุจุงุฒ/ุจุณุช ูโุดู
- ุฏฺฉูู **"ุจุงุฒ ฺฉุฑุฏู ููู"** โ ุชูุงู ูพูุดูโูุง ุจุงุฒ ูุดู
- ุฏฺฉูู **"ุจุณุชู ููู"** โ ููู ุจุณุชู ูุดู (ููุท `api` ุจุงุฒ ูโูููู)

### 4๏ธโฃ ุฌุณุชุฌู ููุดููุฏ

- ุฌุณุชุฌู ุฏุฑ path endpoint ูุง
- ุฌุณุชุฌู ุฏุฑ title ู description
- ููุชุฑ ฺฉุฑุฏู ููุดููุฏ ุฏุฑุฎุช (ููุท ูุชุงุฌ ูุฑุชุจุท ููุงุด ุฏุงุฏู ูุดู)

### 5๏ธโฃ ุงูุชุฎุงุจ ูุชุฏูุง

ุจุฑุง ูุฑ endpoint:

- โ ุฏฺฉูู "ุงูุชุฎุงุจ ููู" โ ุงูุชุฎุงุจ/ูุบู ุชูุงู ูุชุฏูุง
- โ ุฏฺฉููโูุง ุฌุฏุงฺฏุงูู ุจุฑุง ูุฑ ูุชุฏ (GET, POST, PUT, DELETE)
- โ ุฑูฺฏโุจูุฏ ูุชูุงูุช:
  - ๐ต **GET** (ุขุจ) - ูุดุงูุฏู
  - ๐ข **POST** (ุณุจุฒ) - ุงุฌุงุฏ
  - ๐ **PUT** (ูุงุฑูุฌ) - ูุฑุงุด
  - ๐ด **DELETE** (ูุฑูุฒ) - ุญุฐู

### 6๏ธโฃ ุขูุงุฑ ุฒูุฏู

- ุชุนุฏุงุฏ endpoint ูุง ุงูุชุฎุงุจ ุดุฏู
- ุชุนุฏุงุฏ ูุชุฏูุง ุงูุชุฎุงุจ ุดุฏู (ูุฌููุน)

---

## ๐ ูุญูู ุงุณุชูุงุฏู

### 1. ุฏุฑ ฺฉุงููพูููุช React

```javascript
import ApiPermissionTree from "@/components/admin/ApiPermissionTree";

export default function RoleEdit() {
  const [apiPermissions, setApiPermissions] = useState([]);
  const [apis, setApis] = useState({});

  // Fetch APIs grouped by module
  useEffect(() => {
    fetch("/api/admin/rbac/apis?grouped=true")
      .then((res) => res.json())
      .then((data) => {
        if (data.success) {
          setApis(data.apis);
        }
      });
  }, []);

  const handleChange = (permissions) => {
    setApiPermissions(permissions);
  };

  return (
    <ApiPermissionTree
      apis={apis}
      selectedPermissions={apiPermissions}
      onChange={handleChange}
    />
  );
}
```

### 2. ูุฑูุช ูุฑูุฏ (apis)

```javascript
{
  "admin": [
    {
      "_id": "...",
      "path": "/api/admin/users",
      "availableMethods": ["GET", "POST"],
      "title": "ูุฏุฑุช ฺฉุงุฑุจุฑุงู",
      "description": "ูุณุช ู ุงุฌุงุฏ ฺฉุงุฑุจุฑุงู"
    },
    {
      "_id": "...",
      "path": "/api/admin/users/:id",
      "availableMethods": ["GET", "PUT", "DELETE"],
      "title": "ุนููุงุช ุฑู ฺฉุงุฑุจุฑ"
    }
  ],
  "auth": [
    ...
  ]
}
```

### 3. ูุฑูุช ูุฑูุฏ (selectedPermissions)

```javascript
[
  {
    path: "/api/admin/users",
    methods: ["GET", "POST"],
  },
  {
    path: "/api/admin/users/:id",
    methods: ["GET", "PUT"],
  },
];
```

### 4. ูุฑูุช ุฎุฑูุฌ (onChange)

ููุงู ูุฑูุช `selectedPermissions`:

```javascript
[
  {
    path: "/api/admin/users",
    methods: ["GET", "POST"],
  },
  {
    path: "/api/admin/users/:id",
    methods: ["PUT"],
  },
];
```

---

## ๐ ูุซุงู ฺฉุงุฑุจุฑุฏ

### ุณูุงุฑู: ุชุนุฑู ููุด "ูุฏุฑ ูุญุชูุง"

1. ุจุฑู ุจู `/admin/rbac/roles`
2. ููุด "ูุฏุฑ ูุญุชูุง" ุฑู ุงูุชุฎุงุจ ฺฉู ุง ุจุณุงุฒ
3. ุชุจ **"ุฏุณุชุฑุณ ุจู API"** ุฑู ุจุงุฒ ฺฉู
4. ุฏุฑ tree:
   ```
   ๐ api
     ๐ admin
       ๐ users
         ๐ /api/admin/users
           โ GET  โ POST  โ ููุท ูุดุงูุฏู
   ```
5. ุงูู endpoint ุฑู ูพุฏุง ฺฉูุ ููุท `GET` ุฑู ุชฺฉ ุจุฒู
6. ุฐุฎุฑู ฺฉู

**ูุชุฌู**: ูุฏุฑ ูุญุชูุง ููุท ูโุชููู ูุณุช ฺฉุงุฑุจุฑุงู ุฑู ุจุจููุ ููโุชููู ฺฉุงุฑุจุฑ ุฌุฏุฏ ุจุณุงุฒู.

---

## ๐ก ูฺฉุงุช

### 1. ุณุฑุนุช ุจุฎุดุฏู ุจู ฺฉุงุฑ

- ุงุฒ ุฏฺฉูู **"ุจุงุฒ ฺฉุฑุฏู ููู"** ุงุณุชูุงุฏู ฺฉู ุชุง ููู endpoint ูุง ุฑู ุจุจู
- ุงุฒ **Search** ุจุฑุง ูพุฏุง ฺฉุฑุฏู ุณุฑุน endpoint ููุฑุฏ ูุธุฑ ุงุณุชูุงุฏู ฺฉู

### 2. ุงูุชุฎุงุจ ฺฏุฑูู

- ุจุฑุง ุฏุงุฏู ุฏุณุชุฑุณ ฺฉุงูู ุจู ู endpointุ ุฑู ุฏฺฉูู **"ุงูุชุฎุงุจ ููู"** (ฺฉูุงุฑ ูุชุฏูุง) ฺฉูฺฉ ฺฉู
- ุจุฑุง ูุบู ูููุ ุฏูุจุงุฑู ฺฉูฺฉ ฺฉู

### 3. ุฑูฺฏโูุง

ูุชุฏูุง ุจุฑุงุณุงุณ ุนููฺฉุฑุฏุดูู ุฑูฺฏ ุฏุงุฑูุฏ:

- **ุขุจ (GET)**: ููุท ุฎูุงูุฏู โ ฺฉูุชุฑู ุฎุทุฑ
- **ุณุจุฒ (POST)**: ุงุฌุงุฏ โ ุฎุทุฑ ูุชูุณุท
- **ูุงุฑูุฌ (PUT)**: ูุฑุงุด โ ุฎุทุฑ ูุชูุณุท
- **ูุฑูุฒ (DELETE)**: ุญุฐู โ ุจุดุชุฑู ุฎุทุฑ

**ุชูุตู**: ุจุง ุงุญุชุงุท ุจู DELETE ุฏุณุชุฑุณ ุจุฏู!

---

## ๐ ุนุจโุงุจ

### ุฏุฑุฎุช ุฎุงู ูุณุชุ

```javascript
// ฺฺฉ ฺฉู ฺฉู apis ุจู ุฏุฑุณุช ููุฏ ุดุฏู:
console.log("APIs:", apis);

// ุจุงุฏ ู object ุจุง key ูุง module ุจุงุดู:
// { "admin": [...], "auth": [...], ... }
```

### endpoint ูุง ูุดูู ุฏุงุฏู ููุดูุ

```javascript
// ฺฺฉ ฺฉู ฺฉู ูุฑ API ุญุชูุงู ุงู ููุฏูุง ุฑู ุฏุงุฑู:
{
  "path": "/api/...",           // ุถุฑูุฑ
  "availableMethods": ["GET"],  // ุถุฑูุฑ
  "_id": "..."                  // ุถุฑูุฑ
}
```

### selectedPermissions ุฐุฎุฑู ููุดูุ

```javascript
// ูุทูุฆู ุดู ฺฉู onChange ูุฑุงุฎูุงู ูุดู:
const handleChange = (permissions) => {
  console.log("New permissions:", permissions);
  setApiPermissions(permissions);
};
```

---

## ๐จ ุณูุงุฑุดโุณุงุฒ

### ุชุบุฑ ุฑูฺฏ ูุชุฏูุง

ุฏุฑ `ApiPermissionTree.module.css`:

```css
.methodBtn.blue.active {
  background: #3b82f6; /* ุฑูฺฏ GET */
  color: white;
}

.methodBtn.green.active {
  background: #10b981; /* ุฑูฺฏ POST */
  color: white;
}

/* ... */
```

### ุชุบุฑ ุญุฏุงฺฉุซุฑ ุงุฑุชูุงุน

```css
.tree {
  max-height: 600px; /* ูพุดโูุฑุถ */
  overflow-y: auto;
}
```

---

## ๐ ููุงุณู ุจุง ApiPermissionGrid

| ูฺฺฏ                   | ApiPermissionGrid | ApiPermissionTree |
| ----------------------- | ----------------- | ----------------- |
| ุณุงุฎุชุงุฑ                  | ูุณุช ุณุงุฏู         | ุฏุฑุฎุช ุณูุณูู ูุฑุงุชุจ |
| ุฎูุงูุง                 | ูุชูุณุท             | ุนุงู โญ           |
| ููุงุณุจ ุจุฑุง API ูุง ุฒุงุฏ | ุฎุฑ               | ุจูู โญ            |
| ุจุงุฒ/ุจุณุช ุจุฎุดโูุง          | ูุญุฏูุฏ             | ฺฉุงูู โญ           |
| ุฌุณุชุฌู                   | ุณุงุฏู              | ููุดููุฏ โญ         |
| ุขฺฉููโูุง ุจุตุฑ          | ุฎุฑ               | ุจูู โญ            |

---

## ๐ ูุชุฌูโฺฏุฑ

ฺฉุงููพูููุช `ApiPermissionTree`:

โ **ุณุงุฒูุงูโุงูุชู**: ุณุงุฎุชุงุฑ ุฏุฑุฎุช ูุงุถุญ
โ **ุณุฑุน**: ูพุฏุง ฺฉุฑุฏู endpoint ูุง ุขุณุงู
โ **ุจุตุฑ**: ุขฺฉููโูุง ูุงุถุญ ู ุฑูฺฏโุจูุฏ
โ **ูุฏุฑุชููุฏ**: ููุงุณุจ ุจุฑุง ูพุฑูฺูโูุง ุจุฒุฑฺฏ ุจุง endpoint ูุง ุฒุงุฏ

**ุงุณุชูุงุฏู ฺฉู ู ูุฐุช ุจุจุฑ!** ๐โจ


