# ๐งช ุฑุงูููุง ุชุณุช ููุดโูุง (Testing Roles)

ุงู ูุณุชูุฏ ุฑุงูููุง ฺฉุงูู ุจุฑุง ุชุณุช ุณุณุชู ููุดโูุง ู ุฑูุน ูุดฺฉูุงุช ุงุณุช.

---

## ๐ ฺฺฉ ฺฉุฑุฏู ููุดโูุง ฺฉ ฺฉุงุฑุจุฑ

### ุงุณุชูุงุฏู ุงุฒ ุงุณฺฉุฑูพุช

```bash
npm run check-user 09123456789
```

ุงู ุฏุณุชูุฑ ุชูุงู ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ ุฑุง ููุงุด ูโุฏูุฏ:

- ููุดโูุง ูุนู
- ูุถุนุช ุญุณุงุจ
- ุชุงุฑุฎ ุซุจุชโูุงู
- ุขูุงุฑ ฺฉู ุณุณุชู

---

## ๐ ูุฑุงุญู ุชุณุช ฺฉุงูู

### ุชุณุช 1: ุซุจุชโูุงู ฺฉุงุฑุจุฑ ุนุงุฏ

#### ูุฑุญูู 1: ุซุจุชโูุงู

```
1. ุฑูุชู ุจู http://localhost:3000/login
2. ูุงุฑุฏ ฺฉุฑุฏู ุดูุงุฑู: 09121111111
3. ุงูุชุฎุงุจ: ๐ค ฺฉุงุฑุจุฑ ุนุงุฏ
4. ุฏุฑุงูุช OTP
5. ูุงุฑุฏ ฺฉุฑุฏู ฺฉุฏ (ุงุฒ terminal logs)
6. ุชุงุฏ
```

#### ูุฑุญูู 2: ฺฺฉ ฺฉุฑุฏู ุฏุฑ Terminal

```bash
npm run check-user 09121111111
```

#### ุฎุฑูุฌ ููุฑุฏ ุงูุชุธุงุฑ:

```
โ ฺฉุงุฑุจุฑ ุงูุช ุดุฏ!

๐ ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ุดูุงุฑู ุชููู: 09121111111
   ูุงู ููุงุด: ฺฉุงุฑุจุฑ 1111
   ููุดโูุง: [user]
   ุชุนุฏุงุฏ ููุดโูุง: 1
   ูุถุนุช: active
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ญ ุชุญูู ููุดโูุง:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ User (ฺฉุงุฑุจุฑ ุนุงุฏ): โ ุฏุงุฑุฏ
   โ Event Owner (ูุงูฺฉ ุฑูุฏุงุฏ): โ ูุฏุงุฑุฏ
   โ Moderator (ูุงุธุฑ): โ ูุฏุงุฑุฏ
   โ Admin (ูุฏุฑ): โ ูุฏุงุฑุฏ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

โ **ูููู!** ููุด `user` ุฐุฎุฑู ุดุฏู.

---

### ุชุณุช 2: ุซุจุชโูุงู Event Owner

#### ูุฑุญูู 1: ุซุจุชโูุงู

```
1. ุฑูุชู ุจู http://localhost:3000/login
2. ูุงุฑุฏ ฺฉุฑุฏู ุดูุงุฑู: 09122222222
3. ุงูุชุฎุงุจ: โญ ูุงูฺฉ / ูุฏุฑ ุฑูุฏุงุฏ
4. ุฏุฑุงูุช OTP
5. ูุงุฑุฏ ฺฉุฑุฏู ฺฉุฏ
6. ุชุงุฏ
```

#### ูุฑุญูู 2: ฺฺฉ ฺฉุฑุฏู Logs ุฏุฑ Terminal

ุจุนุฏ ุงุฒ ุชุงุฏ OTPุ ุฏุฑ terminal ุจุงุฏ ุจุจูุฏ:

```
๐ญ Creating new user with roles: [ 'user', 'event_owner' ]
โ User saved with roles: [ 'user', 'event_owner' ]
```

#### ูุฑุญูู 3: ฺฺฉ ฺฉุฑุฏู ุฏุฑ Database

```bash
npm run check-user 09122222222
```

#### ุฎุฑูุฌ ููุฑุฏ ุงูุชุธุงุฑ:

```
โ ฺฉุงุฑุจุฑ ุงูุช ุดุฏ!

๐ ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ุดูุงุฑู ุชููู: 09122222222
   ูุงู ููุงุด: ฺฉุงุฑุจุฑ 2222
   ููุดโูุง: [user, event_owner]
   ุชุนุฏุงุฏ ููุดโูุง: 2
   ูุถุนุช: active
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ญ ุชุญูู ููุดโูุง:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ User (ฺฉุงุฑุจุฑ ุนุงุฏ): โ ุฏุงุฑุฏ
   โ Event Owner (ูุงูฺฉ ุฑูุฏุงุฏ): โ ุฏุงุฑุฏ
   โ Moderator (ูุงุธุฑ): โ ูุฏุงุฑุฏ
   โ Admin (ูุฏุฑ): โ ูุฏุงุฑุฏ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

โ **ูููู!** ูุฑ ุฏู ููุด `user` ู `event_owner` ุฐุฎุฑู ุดุฏูุฏ.

---

## ๐ ุฑูุน ูุดฺฉูุงุช ุฑุงุฌ

### ูุดฺฉู 1: ููุดโูุง ุฐุฎุฑู ููโุดููุฏ

**ุนูุงุฆู:**

- ููุด `event_owner` ุฏุฑ database ูุณุช
- ููุท `["user"]` ุฐุฎุฑู ูโุดูุฏ

**ุจุฑุฑุณโูุง ุงููู:**

#### 1๏ธโฃ ฺฺฉ ฺฉุฑุฏู Frontend

ุฏุฑ Developer Console (F12):

```javascript
// ุจุนุฏ ุงุฒ ุงูุชุฎุงุจ Event Owner
console.log(selectedRole); // ุจุงุฏ "event_owner" ุจุงุดุฏ
```

#### 2๏ธโฃ ฺฺฉ ฺฉุฑุฏู Network

ุฏุฑ Network Tab (F12):

1. ุฑูุชู ุจู tab Network
2. ููุชุฑ: XHR/Fetch
3. ฺฉูฺฉ ุฑู `verify-otp`
4. ุจุฑุฑุณ Request Payload:

```json
{
  "phoneNumber": "09122222222",
  "code": "12345",
  "role": "event_owner" // ๐ ุจุงุฏ ุงู ุจุงุดุฏ
}
```

ุงฺฏุฑ `role` ุงุฑุณุงู ูุดุฏู:

- ูุดฺฉู ุงุฒ Frontend ุงุณุช
- ฺฺฉ ฺฉูุฏ ฺฉู `selectedRole` ุจู `loginWithOTP` ุงุฑุณุงู ูโุดูุฏ

#### 3๏ธโฃ ฺฺฉ ฺฉุฑุฏู Backend Logs

ุฏุฑ Terminal ฺฉู `npm run dev` ุงุฌุฑุง ุดุฏู:

```
๐ญ Creating new user with roles: [ 'user', 'event_owner' ]
โ User saved with roles: [ 'user', 'event_owner' ]
```

ุงฺฏุฑ ุงู log ูุง ููุงุด ููโุดููุฏ:

- ูุดฺฉู ุฏุฑ Backend ุงุณุช
- `role` ุฏุฑุงูุช ููโุดูุฏ ุง validation ุฏุงุฑุฏ

---

### ูุดฺฉู 2: ฺฉุงุฑุจุฑ ุงุฒ ูุจู ูุฌูุฏ ุฏุงุฑุฏ

**ุนูุงุฆู:**

- ูุฑูุฏ ูููู ุงุณุช ุงูุง ููุด ุชุบุฑ ููโฺฉูุฏ (ุฏุฑ ุญุงูุช ุฎุงุต)

**ุฏูู ู ุฑุงูโุญู:**

#### โ ุงุฑุชูุง ููุด (Upgrade) - ุฎูุฏฺฉุงุฑ

ุงฺฏุฑ ฺฉุงุฑุจุฑ ูุจูุงู ุจุง ููุด `user` ุซุจุชโูุงู ฺฉุฑุฏู ู ุจุนุฏุงู ุจุง ููุด `event_owner` ูุงุฑุฏ ุดูุฏ:

```javascript
// ฺฉุงุฑุจุฑ ูุฏู ุจุง ููุด ["user"]
if (role === "event_owner" && !user.roles.includes("event_owner")) {
  user.roles.push("event_owner"); // โ ุงุถุงูู ูุดู
  // ูุชุฌู: ["user", "event_owner"]
}
```

**ุงู ฺฉุงููุงู ุฎูุฏฺฉุงุฑ ุงุณุช!** ๐

#### โ ฺฉุงูุด ููุด (Downgrade) - ุบุฑูุนุงู

ุจุฑุง ุงููุชุ ููุดโูุง ุญุฐู ููโุดููุฏ:

```javascript
// ุงฺฏุฑ ฺฉุงุฑุจุฑ ["user", "event_owner"] ุฏุงุดุชู ุจุงุดู
// ู ุฏูุจุงุฑู ุจุง ููุด "user" ูุงุฑุฏ ุดู
// ููุด event_owner ุญุฐู ููุดู โ (ุงููุช)
```

**ุฑุงูโุญู ุจุฑุง ุญุฐู ููุด:**
ุจุฑุง ุญุฐู ููุด ฺฉุงุฑุจุฑุงู:

1. ุงุฒ Admin Panel ุงุณุชูุงุฏู ฺฉูุฏ
2. ุง ุจุง MongoDB Shell:

```bash
# ูุฑูุฏ ุจู MongoDB
mongosh "mongodb://localhost:27017/plusmeet"

# ุงุถุงูู ฺฉุฑุฏู ููุด event_owner
db.users.updateOne(
  { phoneNumber: "09122222222" },
  { $addToSet: { roles: "event_owner" } }
)

# ฺฺฉ ฺฉุฑุฏู
db.users.findOne({ phoneNumber: "09122222222" }).roles
```

---

### ูุดฺฉู 3: ููุด ุฏุฑ Frontend ููุงุด ุฏุงุฏู ููโุดูุฏ

**ุจุฑุฑุณ localStorage:**

ุฏุฑ Developer Console (F12):

```javascript
const user = JSON.parse(localStorage.getItem("user"));
console.log("User Roles:", user.roles);
```

**ุฎุฑูุฌ ููุฑุฏ ุงูุชุธุงุฑ:**

```javascript
["user", "event_owner"];
```

**ุงฺฏุฑ roles ููุฌูุฏ ูุณุช:**

1. **Logout ู Login ูุฌุฏุฏ**

   ```javascript
   localStorage.clear();
   location.reload();
   ```

2. **ฺฺฉ ฺฉุฑุฏู `toPublicJSON` ุฏุฑ User Model**
   ```javascript
   // ุจุงุฏ roles ุจุฑฺฏุฑุฏุงูุฏู ุดูุฏ
   UserSchema.methods.toPublicJSON = function () {
     return {
       // ...
       roles: this.roles, // โ
       // ...
     };
   };
   ```

---

## ๐ ุชุณุช ุจุง MongoDB Compass

### ุงุชุตุงู

```
mongodb://localhost:27017/plusmeet
```

### Query ฺฉุงุฑุจุฑุงู ุจุง Event Owner

```javascript
{ "roles": "event_owner" }
```

### Query ฺฉุงุฑุจุฑุงู ุจุง ฺูุฏ ููุด

```javascript
{ "roles": { $all: ["user", "event_owner"] } }
```

### ุขูุงุฑ ููุดโูุง

```javascript
db.users.aggregate([
  { $unwind: "$roles" },
  { $group: { _id: "$roles", count: { $sum: 1 } } },
]);
```

---

## ๐งช ุชุณุช Automated

### ุงุฌุงุฏ ฺฉุงุฑุจุฑ ุชุณุช ุจุง cURL

```bash
# 1. ุงุฑุณุงู OTP
curl -X POST http://localhost:3000/api/auth/send-otp \
  -H "Content-Type: application/json" \
  -d '{"phoneNumber": "09123456789"}'

# 2. ุฏุฑุงูุช ฺฉุฏ ุงุฒ terminal logs

# 3. ุชุงุฏ OTP ุจุง ููุด event_owner
curl -X POST http://localhost:3000/api/auth/verify-otp \
  -H "Content-Type: application/json" \
  -d '{
    "phoneNumber": "09123456789",
    "code": "12345",
    "role": "event_owner"
  }'
```

---

## โ ฺฺฉโูุณุช ุชุณุช ฺฉุงูู

### ูุจู ุงุฒ ุชุณุช:

- [ ] MongoDB ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณุช
- [ ] Server ุงุฌุฑุง ุดุฏู (`npm run dev`)
- [ ] Console logs ูุงุจู ูุดุงูุฏู ุงุณุช
- [ ] Browser DevTools ุจุงุฒ ุงุณุช

### ุชุณุช ุซุจุชโูุงู:

- [ ] ฺฉุงุฑุจุฑ ุนุงุฏ ุจุง ููุด `["user"]` ุซุจุช ูโุดูุฏ
- [ ] Event Owner ุจุง ููุด `["user", "event_owner"]` ุซุจุช ูโุดูุฏ
- [ ] Logs ุฏุฑ terminal ููุงุด ุฏุงุฏู ูโุดููุฏ
- [ ] ููุดโูุง ุฏุฑ database ุฐุฎุฑู ูโุดููุฏ

### ุชุณุช Frontend:

- [ ] ููุดโูุง ุฏุฑ localStorage ููุฌูุฏ ูุณุชูุฏ
- [ ] ููุดโูุง ุฏุฑ AuthContext ูุงุจู ุฏุณุชุฑุณ ูุณุชูุฏ
- [ ] UI ุจุฑ ุงุณุงุณ ููุดโูุง ุชุบุฑ ูโฺฉูุฏ

### ุชุณุช ุงููุช:

- [ ] ฺฉุงุฑุจุฑุงู ูุฏู ููุดุดุงู ุชุบุฑ ููโฺฉูุฏ
- [ ] ููุท admin ูโุชูุงูุฏ moderator ุชุฎุตุต ุฏูุฏ
- [ ] guest ููโุชูุงูุฏ ุซุจุชโูุงู ฺฉูุฏ (ููุท ูุดุงูุฏู)

---

## ๐ ฺฉูฺฉ ุจุดุชุฑ

ุงฺฏุฑ ููฺูุงู ูุดฺฉู ุฏุงุฑุฏ:

1. **ูุงฺฏโูุง ฺฉุงูู ุฑุง ุฌูุนโุขูุฑ ฺฉูุฏ:**

   - Browser Console
   - Network Tab (Request/Response)
   - Server Terminal Logs

2. **ุงุทูุงุนุงุช ุฒุฑ ุฑุง ุจุฑุฑุณ ฺฉูุฏ:**

   - ุดูุงุฑู ุชููู ฺฉุงุฑุจุฑ
   - ููุด ุงูุชุฎุงุจ
   - ุฒูุงู ุซุจุชโูุงู
   - ูพุงูโูุง ุฎุทุง

3. **ุงุณฺฉุฑูพุชโูุง ุฏุจุงฺฏ ุฑุง ุงุฌุฑุง ฺฉูุฏ:**
   ```bash
   npm run check-user [phoneNumber]
   npm run check-admin
   ```

---

**ุขุฎุฑู ุจูโุฑูุฒุฑุณุงู:** 2025-01-27
