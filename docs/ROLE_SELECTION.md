# ๐ญ ุณุณุชู ุงูุชุฎุงุจ ููุด ุฏุฑ ุซุจุชโูุงู

ุงู ูุณุชูุฏ ุชูุถุญุงุช ฺฉุงูู ุฏุฑุจุงุฑู ุณุณุชู ุงูุชุฎุงุจ ููุด ุฏุฑ ุฒูุงู ุซุจุชโูุงู ุงุฑุงุฆู ูโุฏูุฏ.

---

## ๐ ููุดโูุง ูุงุจู ุงูุชุฎุงุจ

ฺฉุงุฑุจุฑุงู ุฏุฑ ุฒูุงู ุซุจุชโูุงู ูโุชูุงููุฏ ฺฉ ุงุฒ ุฏู ููุน ุญุณุงุจ ุฑุง ุงูุชุฎุงุจ ฺฉููุฏ:

### 1๏ธโฃ ฺฉุงุฑุจุฑ ุนุงุฏ (User)

**ููุด:** `["user"]`

**ุงูฺฉุงูุงุช:**

- ุดุฑฺฉุช ุฏุฑ ุฑูุฏุงุฏูุง
- ุงุฑุชุจุงุท ุจุง ุฏฺฏุฑ ฺฉุงุฑุจุฑุงู
- ูพูุณุชู ุจู ุชูโูุง
- ูุดุงูุฏู ู ุฌุณุชุฌู ุฑูุฏุงุฏูุง
- ูุฏุฑุช ูพุฑููุงู ุดุฎุต

**ููุงุณุจ ุจุฑุง:**

- ุงูุฑุงุฏ ฺฉู ูโุฎูุงููุฏ ุฏุฑ ุฑูุฏุงุฏูุง ุดุฑฺฉุช ฺฉููุฏ
- ฺฉุณุงู ฺฉู ุจู ุฏูุจุงู ููุฑุงู ุจุฑุง ูุนุงูุชโูุง ูุณุชูุฏ
- ุงุนุถุง ุชูโูุง ู ฺฏุฑููโูุง

---

### 2๏ธโฃ ูุงูฺฉ / ูุฏุฑ ุฑูุฏุงุฏ (Event Owner)

**ููุด:** `["user", "event_owner"]`

**ุงูฺฉุงูุงุช:**

- ุชูุงู ุงูฺฉุงูุงุช ฺฉุงุฑุจุฑ ุนุงุฏ
- โจ **ุงุฌุงุฏ ุฑูุฏุงุฏ**
- โจ **ุชุดฺฉู ุชู**
- โจ **ูุฏุฑุช ุงุนุถุง**
- โจ **ูุฏุฑุช ูุงู ุฑูุฏุงุฏ**
- โจ **ุฏุฑุฎูุงุณุชโูุง ุนุถูุช**
- โจ **ุชูุธูุงุช ุฑูุฏุงุฏ**

**ููุงุณุจ ุจุฑุง:**

- ุณุงุฒูุงูุฏููุฏฺฏุงู ุฑูุฏุงุฏูุง
- ุจุฑฺฏุฒุงุฑฺฉููุฏฺฏุงู ฺฉุงุฑฺฏุงูโูุง ู ุฏูุฑูโูุง
- ูุฏุฑุงู ุชูโูุง ูุฑุฒุด
- ุงูุฑุงุฏ ุง ุณุงุฒูุงูโูุง ุจุฑฺฏุฒุงุฑฺฉููุฏู

---

## ๐ซ ููุดโูุง ุบุฑูุงุจู ุงูุชุฎุงุจ

### Moderator (ูุงุธุฑ ูุญุชูุง)

**ููุด:** `["user", "moderator"]`

**ูุญุฏูุฏุช:** ููุท ุชูุณุท **Admin** ูุงุจู ุชุฎุตุต ุงุณุช.

**ุงูฺฉุงูุงุช:**

- ุจุฑุฑุณ ุชุฎููุงุช
- ูุฏุฑุช ฺฏุฒุงุฑุดโูุง
- ุชุงุฏ ุง ุฑุฏ ูุญุชูุง
- ูุณุฏูุฏ ฺฉุฑุฏู ูุญุชูุง ูุงููุงุณุจ

**ฺุฑุง ูุงุจู ุงูุชุฎุงุจ ูุณุชุ**
ุงู ููุด ูุงุฒููุฏ ุงุนุชูุงุฏ ู ุงุฎุชุงุฑุงุช ุฎุงุต ุงุณุช ู ุจุงุฏ ุชูุณุท ูุฏุฑ ุณุณุชู ุชุฎุตุต ุฏุงุฏู ุดูุฏ.

---

### Admin (ูุฏุฑ ุณุณุชู)

**ููุด:** `["user", "admin"]`

**ูุญุฏูุฏุช:** ููุท ุงุฒ ุทุฑู **ุงุณฺฉุฑูพุช** ุง **ูุฏุฑ ูุจู** ูุงุจู ุงุฌุงุฏ ุงุณุช.

**ุงูฺฉุงูุงุช:**

- ฺฉูุชุฑู ฺฉุงูู ุณุณุชู
- ูุฏุฑุช ฺฉุงุฑุจุฑุงู
- ุชุฎุตุต ููุดโูุง
- ุชูุธูุงุช ุณุณุชู
- ุฏุณุชุฑุณ ุจู Admin Panel

---

## ๐ป ูพุงุฏูโุณุงุฒ

### Frontend

#### UI Components

ุฏุฑ ุตูุญู ูุงฺฏู **ูุจู ุงุฒ ุงุฑุณุงู OTP**ุ ุจุฑุง ููู ฺฉุงุฑุจุฑุงู:

```jsx
{
  /* ุงูุชุฎุงุจ ููุน ุญุณุงุจ ุจู ุตูุฑุช ุฏฺฉูู */
}
<div className={styles.inputGroup}>
  <label className={styles.label}>ููุน ุญุณุงุจ ฺฉุงุฑุจุฑ</label>
  <div className={styles.roleButtons}>
    <button
      type="button"
      className={`${styles.roleButton} ${
        selectedRole === "user" ? styles.roleButtonActive : ""
      }`}
      onClick={() => setSelectedRole("user")}
    >
      <span className={styles.roleIcon}>๐ค</span>
      <span className={styles.roleTitle}>ฺฉุงุฑุจุฑ ุนุงุฏ</span>
      <span className={styles.roleDesc}>ุดุฑฺฉุช ุฏุฑ ุฑูุฏุงุฏูุง</span>
    </button>
    <button
      type="button"
      className={`${styles.roleButton} ${
        selectedRole === "event_owner" ? styles.roleButtonActive : ""
      }`}
      onClick={() => setSelectedRole("event_owner")}
    >
      <span className={styles.roleIcon}>โญ</span>
      <span className={styles.roleTitle}>ูุงูฺฉ / ูุฏุฑ ุฑูุฏุงุฏ</span>
      <span className={styles.roleDesc}>ุงุฌุงุฏ ู ูุฏุฑุช ุฑูุฏุงุฏ</span>
    </button>
  </div>
</div>;
```

**ูฺฉุงุช ููู:**

1. ุงูุชุฎุงุจ ููุด ุจู ุตูุฑุช **ุฏฺฉูู** (ูู dropdown) ุจุฑุง UX ุจูุชุฑ
2. ููุงุด ุงููุฌุ ุนููุงู ู ุชูุถุญุงุช ุฏุฑ ูุฑ ุฏฺฉูู
3. ุญุงูุช Active ุจุง ุฑูฺฏ ู ุณุงู ูุชูุงูุช
4. Responsive: ุฏุฑ ููุจุงู ุฏฺฉููโูุง ุจู ุตูุฑุช ุนููุฏ
5. ุงูุชุฎุงุจ ุฏุฑ ูุฑุญูู ุงูู (ูุจู ุงุฒ ุงุฑุณุงู OTP)

#### AuthContext

```javascript
const loginWithOTP = async (phoneNumber, code, role) => {
  const body = { phoneNumber, code };
  if (role) {
    body.role = role;
  }

  const response = await fetch("/api/auth/verify-otp", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body),
  });

  // ...
};
```

**ุชุบุฑ ุฏุฑ ููู:**

1. ฺฉุงุฑุจุฑ ุดูุงุฑู ููุจุงู ู ููุน ุญุณุงุจ ุฑุง ุงูุชุฎุงุจ ูโฺฉูุฏ
2. ุฏฺฉูู "ุฏุฑุงูุช ฺฉุฏ ุชุงุฏ" ุฑุง ูโุฒูุฏ
3. OTP ุฏุฑุงูุช ูโุดูุฏ
4. ฺฉุฏ ุฑุง ูุงุฑุฏ ูโฺฉูุฏ
5. ุฏุฑ backendุ ุงฺฏุฑ ฺฉุงุฑุจุฑ ุฌุฏุฏ ุจุงุดุฏุ ููุด ุงูุชุฎุงุจโุดุฏู ุงุนูุงู ูโุดูุฏ
6. ุงฺฏุฑ ฺฉุงุฑุจุฑ ูุฏู ุจุงุดุฏุ ููุด ุชุบุฑ ููโฺฉูุฏ

---

### Backend

#### API Route: `/api/auth/verify-otp`

```javascript
const { phoneNumber, code, role } = await request.json();

// ...

if (!user) {
  // ุซุจุชโูุงู ฺฉุงุฑุจุฑ ุฌุฏุฏ
  isNewUser = true;

  // ุชุนู ููุดโูุง ุจุฑ ุงุณุงุณ ุงูุชุฎุงุจ ฺฉุงุฑุจุฑ
  let userRoles = ["user"]; // ูพุดโูุฑุถ
  if (role === "event_owner") {
    userRoles.push("event_owner");
  }

  user = new User({
    phoneNumber,
    firstName: "ฺฉุงุฑุจุฑ",
    lastName: phoneNumber.substring(7),
    displayName: `ฺฉุงุฑุจุฑ ${phoneNumber.substring(7)}`,
    roles: userRoles,
    state: "active",
    userType: "individual",
    lastLoginAt: new Date(),
  });

  await user.save();
}
```

---

## ๐จ ุทุฑุงุญ UI

### ุงุณุชุงู ุฏฺฉููโูุง

```css
.roleButtons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.roleButton {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  padding: 1.25rem 1rem;
  border: 2px solid var(--color-border);
  border-radius: 12px;
  background: var(--color-bg-primary);
  transition: all 0.3s ease;
}

.roleButton:hover {
  border-color: var(--color-primary);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.roleButtonActive {
  border-color: var(--color-primary);
  background: var(--color-primary-bg);
  box-shadow: 0 4px 12px rgba(244, 163, 37, 0.2);
}

.roleIcon {
  font-size: 2rem;
}

.roleTitle {
  font-weight: 600;
  font-size: 0.95rem;
}

.roleDesc {
  font-size: 0.8rem;
  color: var(--color-text-secondary);
}
```

### Responsive

- **Desktop:** ุฏู ุฏฺฉูู ุฏุฑ ฺฉูุงุฑ ูู (grid 2 columns)
- **Mobile:** ุฏฺฉููโูุง ุจู ุตูุฑุช ุนููุฏ (grid 1 column)
- **Hover Effect:** ุชุบุฑ ุฑูฺฏ border ู ุงููุดู translateY
- **Active State:** ูพุณโุฒููู ุฑูฺฏ ู ุณุงู

---

## ๐ ุงููุช

### ุงุนุชุจุงุฑุณูุฌ Backend

```javascript
// ููุท role ูุง ูุฌุงุฒ
const allowedRoles = ["user", "event_owner"];
if (role && !allowedRoles.includes(role)) {
  return NextResponse.json({ error: "Invalid role" }, { status: 400 });
}
```

### ูุญุฏูุฏุชโูุง

1. โ ฺฉุงุฑุจุฑ ููโุชูุงูุฏ `moderator` ุง `admin` ุงูุชุฎุงุจ ฺฉูุฏ
2. โ ููุดโูุง ุงุถุงู ุจุงุฏ ุชูุณุท Admin ุชุฎุตุต ุฏุงุฏู ุดููุฏ
3. โ ููุท ุฏุฑ ุฒูุงู ุซุจุชโูุงู ูุงุจู ุงูุชุฎุงุจ ุงุณุช
4. โ ุจุนุฏ ุงุฒ ุซุจุชโูุงูุ ุชุบุฑ ููุด ููุท ุงุฒ ุทุฑู Admin Panel

---

## ๐งช ุชุณุช

### ุชุณุช 1: ฺฉุงุฑุจุฑ ุนุงุฏ

```bash
POST /api/auth/verify-otp
{
  "phoneNumber": "09123456789",
  "code": "12345",
  "role": "user"
}

# Expected Response:
{
  "success": true,
  "data": {
    "user": {
      "phoneNumber": "09123456789",
      "roles": ["user"]
    }
  }
}
```

### ุชุณุช 2: Event Owner

```bash
POST /api/auth/verify-otp
{
  "phoneNumber": "09123456790",
  "code": "12345",
  "role": "event_owner"
}

# Expected Response:
{
  "success": true,
  "data": {
    "user": {
      "phoneNumber": "09123456790",
      "roles": ["user", "event_owner"]
    }
  }
}
```

### ุชุณุช 3: ุจุฏูู ุงูุชุฎุงุจ (ูพุดโูุฑุถ)

```bash
POST /api/auth/verify-otp
{
  "phoneNumber": "09123456791",
  "code": "12345"
}

# Expected Response:
{
  "success": true,
  "data": {
    "user": {
      "phoneNumber": "09123456791",
      "roles": ["user"]  # ููุด ูพุดโูุฑุถ
    }
  }
}
```

---

## ๐ ุชุบุฑ ููุด ุจุนุฏ ุงุฒ ุซุจุชโูุงู

### ุชูุณุท ฺฉุงุฑุจุฑ

โ **ุบุฑููฺฉู** - ฺฉุงุฑุจุฑ ููโุชูุงูุฏ ุฎูุฏุด ููุดุด ุฑุง ุชุบุฑ ุฏูุฏ.

### ุชูุณุท Admin

โ **ููฺฉู** - ุงุฒ ุทุฑู Admin Panel:

1. ุฑูุชู ุจู ุตูุญู User Management
2. ุงูุชุฎุงุจ ฺฉุงุฑุจุฑ
3. ฺฉูฺฉ ุฑู "Manage Roles"
4. ุงุถุงูู/ุญุฐู ููุดโูุง

```
/admin/users โ Select User โ Manage Roles โ Update
```

---

## ๐ ุขูุงุฑ ู ฺฏุฒุงุฑุดโูุง

### ุชุนุฏุงุฏ ฺฉุงุฑุจุฑุงู ุจุฑ ุงุณุงุณ ููุด

```javascript
// ุฏุฑ Admin Dashboard
const userStats = {
  totalUsers: await User.countDocuments(),
  regularUsers: await User.countDocuments({ roles: ["user"] }),
  eventOwners: await User.countDocuments({ roles: { $in: ["event_owner"] } }),
  moderators: await User.countDocuments({ roles: { $in: ["moderator"] } }),
  admins: await User.countDocuments({ roles: { $in: ["admin"] } }),
};
```

---

## ๐ก ูฺฉุงุช ููู

### ุจุฑุง ฺฉุงุฑุจุฑุงู

1. ููุด ุฑุง ุจุง ุฏูุช ุงูุชุฎุงุจ ฺฉูุฏ
2. ูโุชูุงูุฏ ุจุนุฏุงู ุงุฒ ุทุฑู Admin ููุด ุงุถุงูู ฺฉูุฏ
3. Event Owner ูโุชูุงูุฏ ุฏุฑ ุฑูุฏุงุฏูุง ุดุฑฺฉุช ฺฉูุฏ (ูุฑ ุฏู ููุด ุฑุง ุฏุงุฑุฏ)

### ุจุฑุง ุชูุณุนูโุฏููุฏฺฏุงู

1. ููุดู `user` ุฑุง ุฏุฑ array ููุดโูุง ูฺฏู ุฏุงุฑุฏ
2. ุงุฒ middleware ุจุฑุง ฺฺฉ ฺฉุฑุฏู ููุดโูุง ุงุณุชูุงุฏู ฺฉูุฏ
3. Log ฺฉุฑุฏู ุชุบุฑุงุช ููุดโูุง ุฏุฑ ActivityLog

### ุจุฑุง Admins

1. ููุด Moderator ุฑุง ููุท ุจู ุงูุฑุงุฏ ููุฑุฏ ุงุนุชูุงุฏ ุจุฏูุฏ
2. Admin ุฑุง ููุท ุงุฒ ุทุฑู ุงุณฺฉุฑูพุช ุงุฌุงุฏ ฺฉูุฏ
3. ุชุบุฑุงุช ููุดโูุง ุฏุฑ ActivityLog ุซุจุช ูโุดูุฏ

---

## ๐ ูุณุชูุฏุงุช ูุฑุชุจุท

- [User System](./USER_SYSTEM.md)
- [RBAC Guide](./RBAC_GUIDE.md)
- [Admin Panel](./ADMIN_PANEL.md)
- [Authentication](./AUTH_DEBUGGING.md)

---

**ุขุฎุฑู ุจูโุฑูุฒุฑุณุงู:** 2025-01-27
